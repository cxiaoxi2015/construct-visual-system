<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>城乡建设领域碳排放监测管理平台</title>
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/iconfont.css">
    <link rel="stylesheet" href="../css/elementUI.css">
    <link rel="stylesheet" href="../css/index.css">
    <link rel="stylesheet" href="../css/page/xianzhuang.css">
</head>
<body>
    <div id="app">
        <div class="sys-title">城乡建设领域碳排放监测管理平台</div>

        <!-- header -->
        <div class="sys-header">
            <div class="full-screen iconfont">&#xe607;</div>
            <div class="home">
                <div class="home-icon iconfont">&#xe751;</div>
                <span class="home-text">首页</span>
            </div>
            <div class="nav">
                <ul class="nav-left">
                    <li v-for="(item, index) in navLeft" :class="{ 'nav-active': item.active }" :key="index" @click="handleNavClick(item)">
                        <div class="nav-icon" :style="{ 'background-image': `url(${item.iconPath})`, '--bgActive': `url(${item.iconPathActive})` }"></div>
                        <div class="nav-name">{{ item.name }}</div>
                    </li>
                </ul>
                <div class="sys-title-placeholder"></div>
                <ul class="nav-right">
                    <li v-for="(item, index) in navRight" :class="{ 'nav-active': item.active }" :key="index" @click="handleNavClick(item)">
                        <div class="nav-icon" :style="{ 'background-image': `url(${item.iconPath})`, '--bgActive': `url(${item.iconPathActive})` }"></div>
                        <div class="nav-name" v-if="item.name.length <= 4">{{ item.name }}</div>
                        <dl class="nav-name" v-else>
                            <dt>{{ item.name.substring(0, 4) }}</dt>
                            <dd>{{ item.name.substring(4) }}</dd>
                        </dl>
                    </li>
                </ul>
            </div>
            <div class="header-right-line"></div>
            <div class="header-right">
                <div class="header-right-top">
                    <img class="avatar" src="https://shadow.elemecdn.com/app/element/hamburger.9cf7b091-55e9-11e9-a976-7f4d0b07eef6.png" />
                    <div class="text">
                        <span>欢迎您！</span>
                        <a>{{ userName }}</a>
                    </div>
                </div>
                <div class="header-right-bottom">{{ dateTime }}</div>
            </div>
        </div>

        <!-- 年度切换 -->
        <div class="sys-toggle-area">
            <div class="year-group">
                <div class="label">年度</div>
                <div class="cx-select">
                    <div class="cx-select-input">
                        {{ year }}
                        <div class="cx-select-suffix iconfont">&#xe64b;</div>
                    </div>
                    <ul class="cx-option">
                        <li v-for="yearDate in yearOptions" :class="[yearDate === year && 'year-active']" :key="yearDate" @click="handleYearClick(yearDate)">{{ yearDate }}</li>
                    </ul>
                </div>
            </div>
            <div class="energy-group">
                <div class="energy-group-item energy-group-item--active">用能</div>
                <div class="energy-group-item">排放</div>
            </div>
            <div class="area-line"></div>
            <div class="area-group">
                <div :class="leftBtnClass"
                     @click="handleMapChina">全国</div>
                <div :class="rightBtnClass">各地</div>
            </div>
            <div class="cx-placeholder">
                <div class="analyse" @click="handleCompareAnalysisClick">
                    <div class="analyse-icon"></div>
                    <div class="analyse-text">对比分析</div>
                </div>
            </div>
        </div>

        <!-- 系统内容部分 -->
        <div class="container">
            <div class="layout-ele">
                <div class="xz-item">
                    <div class="xz-item-title">能耗总量</div>
                    <div class="chart-container" id="nhzl"></div>
                </div>
                <div class="xz-item">
                    <div class="xz-item-title">用能占比</div>
                    <div class="chart-container" id="ynzb"></div>
                </div>
                <div class="xz-item">
                    <div class="xz-item-title">用能增速</div>
                    <div class="chart-container" id="ynzs"></div>
                </div>
            </div>
            <div class="layout-ele">
                <div class="map-wrap">
                    <div class="energy-consumption">
                        <div class="energy-consumption-title">能耗</div>
                        <div class="energy-consumption-value">
                            <div class="value-item">1</div>
                            <div class="value-item">1</div>
                            <div class="value-item">.</div>
                            <div class="value-item">8</div>
                        </div>
                        <div class="energy-consumption-suffix">亿吨标准煤</div>
                    </div>
                    <div class="map" id="mapContainer"></div>
                </div>
                <div class="category">
                    <div class="category-item"
                         :class="[
                            item.value === category && 'category-item--active',
                            item.size === 'small' && 'category-item-small'
                         ]"
                         v-for="(item, index) in categories"
                         :key="index"
                         @click="handleCategoryClick(item)">{{ item.categoryName }}</div>
                </div>
            </div>
            <div class="layout-ele">
                <div class="xz-item">
                    <div class="xz-item-title">用能结构</div>
                    <div class="chart-container" id="ynjg"></div>
                </div>
                <div class="xz-item">
                    <div class="xz-item-title">电气化率</div>
                    <div class="chart-container" id="dqhl"></div>
                </div>
                <div class="xz-item">
                    <div class="xz-item-title">用能强度</div>
                    <div class="chart-toggle-group">
                        <div class="group-item"
                             :class="[ynqdActive === 1 && 'group-item--active']"
                             @click="handleYNQDToggle(1)">人均</div>
                        <div class="group-item"
                             :class="[ynqdActive === 2 && 'group-item--active']"
                             @click="handleYNQDToggle(2)">面均</div>
                    </div>
                    <div class="chart-container" id="ynqd"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="../js/vue.min.js"></script>
    <script src="../js/element.js"></script>
    <script src="../js/jquery.min.js"></script>
    <script src="../js/select.js"></script>
    <script src="../js/echarts.min.js"></script>
    <script src="../js/moment.min.js"></script>
    <script src="../js/china.js"></script>
    <script>
        const myApp = new Vue({
            el: "#app",
            data: {
                userName: "管理员",
                navList: [
                    {
                        iconPath: "../../assets/images/xianzhuang/xianzhuang-icon.png",
                        iconPathActive: "../../assets/images/xianzhuang/xianzhuang-active-icon.png",
                        name: "现状",
                        location: 'xianzhuang.html',
                        active: true,
                    },
                    {
                        iconPath: "../../assets/images/xianzhuang/yuce-icon.png",
                        iconPathActive: "../../assets/images/xianzhuang/yuce-active-icon.png",
                        name: "预测",
                        location: 'yuce.html'
                    },
                    {
                        iconPath: "../../assets/images/xianzhuang/diaodu-icon.png",
                        iconPathActive: "../../assets/images/xianzhuang/diaodu-active-icon.png",
                        name: "调度"
                    },
                    {
                        iconPath: "../../assets/images/xianzhuang/kaoping-icon.png",
                        iconPathActive: "../../assets/images/xianzhuang/kaoping-active-icon.png",
                        name: "考评"
                    },
                    {
                        iconPath: "../../assets/images/xianzhuang/jianzhu-icon.png",
                        iconPathActive: "../../assets/images/xianzhuang/jianzhu-active-icon.png",
                        name: "重点建筑监管"
                    },
                    {
                        iconPath: "../../assets/images/xianzhuang/hangye-icon.png",
                        iconPathActive: "../../assets/images/xianzhuang/hangye-active-icon.png",
                        name: "重点行业监管"
                    },
                    {
                        iconPath: "../../assets/images/xianzhuang/chanpin-icon.png",
                        iconPathActive: "../../assets/images/xianzhuang/chanpin-active-icon.png",
                        name: "技术产品",
                        location: 'chanpin.html'
                    },
                    {
                        iconPath: "../../assets/images/xianzhuang/shuju-icon.png",
                        iconPathActive: "../../assets/images/xianzhuang/shuju-active-icon.png",
                        name: "数据查询"
                    }
                ],
                year: 2023,
                yearOptions: [ 2023, 2022, 2021, 2020, 2019 ],
                category: 1,
                categories: [
                    { categoryName: "城乡建设领域", value: 1, size: "medium" },
                    { categoryName: "建筑运行", value: 2, size: "medium" },
                    { categoryName: "城镇居建", value: 3, size: "small" },
                    { categoryName: "公共建筑", value: 4, size: "small" },
                    { categoryName: "农村居建", value: 5, size: "small" },
                    { categoryName: "集中供暖", value: 6, size: "small" },
                    { categoryName: "建筑业", value: 7, size: "medium" },
                    { categoryName: "基础设施", value: 8, size: "medium" }
                ],
                // 用能强度
                ynqdActive: 1,
                dateTime: moment(new Date()).format('YYYY/MM/DD HH:mm:ss'),
                dateTimer: null,
                currentYear: '2023',
                mapActive: 'china',
                leftBtnClass: '',
                rightBtnClass: '',
                appReady: false
            },
            methods: {
                handleYearClick(yearDate) {
                    this.year = yearDate;
                    const ele = $('.cx-select');
                    ele.find('.cx-option').slideUp();
                    ele.hasClass('focus')
                        ? ele.removeClass('focus')
                        : ele.addClass('focus')
                },

                handleCategoryClick({ value }) {
                    this.category = value;
                },

                /**
                 * 绘制能耗总量图表
                 */
                drawNHZLChart() {
                    const nhzlData = {
                        gonggong: [],
                        juzhu: [],
                        year: []
                    }
                    for (let year = 2005; year < new Date().getFullYear() + 1; year++) {
                        nhzlData.gonggong.push((Math.random() * 100).toFixed(2))
                        nhzlData.juzhu.push((Math.random() * 100).toFixed(2))
                        nhzlData.year.push(year)
                    }
                    const myChart = echarts.init(document.getElementById('nhzl'));
                    const option = {
                        backgroundColor:  'transparent',
                        tooltip: {
                            trigger: 'axis',
                            axisPointer: {
                                type: 'shadow'
                            },
                            confine: true,
                            formatter: function(params){
                                let relVal = `${params[0].name}年`;
                                let prefix
                                for (let i = 0, l = params.length; i < l; i++) {
                                    prefix = `<span style="display:inline-block;margin-right:5px;border-radius:10px;width:9px;height:9px;background-color: ${params[i].color.colorStops[0].color}"></span>`
                                    relVal += '<br/>' + prefix + `${params[i].seriesName}` + ' : ' + `${params[i].value} 亿tce`;
                                }
                                return relVal;
                            }
                        },
                        grid: {
                            top: '25%',
                            left: '5%',
                            right: '8%',
                            bottom: '15%',
                            containLabel: true
                        },
                        legend: {
                            x:'right',
                            y:'top',
                            padding: [20, 30, 0, 0],
                            itemGap: 34,
                            data: ['统计', '拆分'],
                            textStyle: {
                                color: '#fff',
                                fontSize: '.12rem'
                            },
                            itemWidth: 10,
                            itemHeight: 4
                        },
                        xAxis: [
                            {
                                type: "category",
                                axisTick: {
                                    show: false,
                                },
                                axisLine: {
                                    lineStyle: {
                                        color: 'rgba(255, 255, 255, .05)'
                                    }
                                },
                                data: nhzlData.year,
                                axisLabel: {
                                    margin: 10,
                                    fontSize: '.1rem',
                                    formatter: "{value}年",
                                    color: '#fff'
                                }
                            },
                        ],
                        yAxis: [
                            {
                                type: "value",
                                name: '单位：亿tce',
                                nameTextStyle: {
                                    color: "#fff",
                                    fontSize: "",
                                    padding: [0, 0, 0, 0],
                                },
                                show: true,
                                axisTick: {
                                    show: false,
                                },
                                axisLine: {
                                    show: false,
                                },
                                splitLine: {
                                    show: true,
                                    lineStyle: {
                                        color: "rgba(255, 255, 255, .09)"
                                    }
                                },
                                axisLabel: {
                                    fontSize: '.12rem',
                                    color: '#fff'
                                }
                            },
                        ],
                        dataZoom: [
                            {
                                type: 'slider',
                                startValue: 0,
                                endValue: 7,
                                bottom: '20',
                                left: '30',
                                height: 10,
                                borderColor: '#1479A1',
                                textStyle: {
                                    color: '#05D5FF',
                                },
                                backgroundColor: '#032E5C',
                                dataBackground: {
                                    lineStyle: { color: 'rgba(250, 84, 28, .3)' },
                                    areaStyle: { color: 'rgba(250, 84, 28, .5)' }
                                },
                                moveHandleStyle: {
                                    color: 'rgba(38, 203, 251, 1)',
                                    borderColor: 'rgba(38, 203, 251, 1)'
                                },
                                fillerColor: 'rgba(250, 84, 28, .1)'
                            }
                        ],
                        series: [
                            {
                                name: "统计",
                                type: "bar",
                                barWidth: 8,
                                itemStyle: {
                                    borderWidth: 2,
                                    color: new echarts.graphic.LinearGradient(0, 1, 0, 0, [
                                        {
                                            offset: 0,
                                            color: "#F5804D",
                                        },
                                        {
                                            offset: 1,
                                            color: '#FCCB05'
                                        }
                                    ]),
                                    borderRadius: 3
                                },
                                data: nhzlData.gonggong,
                            },
                            {
                                name: "拆分",
                                type: "bar",
                                barWidth: 8,
                                barGap: "50%",
                                label: {
                                    show: false
                                },
                                itemStyle: {
                                    borderWidth: 2,
                                    color: new echarts.graphic.LinearGradient(0, 1, 0, 0, [
                                        {
                                            offset: 0,
                                            color: "#6851F1",
                                        },
                                        {
                                            offset: 1,
                                            color: '#248FF7'
                                        }
                                    ]),
                                    borderRadius: 3
                                },
                                data: nhzlData.juzhu,
                            }
                        ]
                    };
                    myChart.setOption(option)
                },

                /**
                 * 绘制用能占比图表
                 */
                drawYNZBChart() {
                    const myChart = echarts.init(document.getElementById('ynzb'));
                    const seriesData = [], yearData = [];
                    for (let year = 2005; year < new Date().getFullYear() + 1; year++) {
                        yearData.push(year)
                        seriesData.push((Math.random() * 10).toFixed(1))
                    }
                    const option = {
                        backgroundColor: 'transparent',
                        tooltip: {
                            trigger: 'axis',
                            confine: true,
                            extraCssText: "background-color: transparent; padding: 0 5px; border-color: transparent;",
                            formatter: function(params){
                                return `<div class="cx-tooltip">占比: ${params[0].value}%</div>`
                            },
                            axisPointer: {
                                type: 'cross',
                                crossStyle: {
                                    color: '#fff'
                                },
                                lineStyle: {
                                    type: 'dashed'
                                }
                            }
                        },
                        grid: {
                            top: '20%',
                            left: '5%',
                            right: '8%',
                            bottom: '15%',
                            containLabel: true
                        },
                        xAxis: {
                            type: 'category',
                            data: yearData,
                            axisTick: {
                                show: false,
                            },
                            axisLine: {
                                lineStyle: {
                                    color: 'rgba(255, 255, 255, .05)'
                                }
                            },
                            axisLabel: {
                                margin: 10,
                                fontSize: '.1rem',
                                formatter: "{value}年",
                                color: '#fff'
                            }
                        },
                        yAxis: {
                            type: "value",
                            name: '单位：%',
                            nameTextStyle: {
                                color: "#fff",
                                fontSize: "",
                                padding: [0, 0, 0, -30],
                            },
                            show: true,
                            axisTick: {
                                show: false,
                            },
                            axisLine: {
                                show: false,
                                lineStyle: {
                                    color: "rgba(255, 255, 255, .09)"
                                }
                            },
                            splitLine: {
                                show: true,
                                lineStyle: {
                                    color: "rgba(255, 255, 255, .09)"
                                }
                            },
                            axisLabel: {
                                fontSize: '.12rem',
                                color: '#fff'
                            }
                        },
                        dataZoom: [
                            {
                                type: 'slider',
                                startValue: 0,
                                endValue: 7,
                                bottom: '20',
                                left: '30',
                                height: 10,
                                borderColor: '#1479A1',
                                textStyle: {
                                    color: '#05D5FF',
                                },
                                backgroundColor: '#032E5C',
                                dataBackground: {
                                    lineStyle: { color: 'rgba(250, 84, 28, .3)' },
                                    areaStyle: { color: 'rgba(250, 84, 28, .5)' }
                                },
                                moveHandleStyle: {
                                    color: 'rgba(38, 203, 251, 1)',
                                    borderColor: 'rgba(38, 203, 251, 1)'
                                },
                                fillerColor: 'rgba(250, 84, 28, .1)'
                            }
                        ],
                        series: {
                            data: seriesData,
                            type: 'line',
                            smooth: true,
                            lineStyle: {
                                color: '#ffd918'
                            },
                            symbolSize: 5,
                            symbol: 'circle',
                            itemStyle: {
                                barBorderRadius: [30, 30, 0, 0],
                                color: '#ffd918',
                                borderColor: '#fff'
                            }
                        }
                    };
                    myChart.setOption(option)
                },

                /**
                 * 绘制用能增速图表
                 */
                drawYNZSChart() {
                    const ynzsData = []
                    for (let year = 2005; year < new Date().getFullYear() + 1; year++) {
                        ynzsData.push({
                            year,
                            plan: (Math.random() * 10).toFixed(1),
                            actual: (Math.random() * 10).toFixed(1)
                        })
                    }
                    const yearData = [], tjData = [], cfData = []
                    ynzsData.forEach(item => {
                        yearData.push(item.year)
                        tjData.push(item.plan)
                        cfData.push(item.actual)
                    })
                    const myChart = echarts.init(document.getElementById('ynzs'));
                    const option = {
                        backgroundColor:  'transparent',
                        tooltip: {
                            trigger: 'axis',
                            confine: true,
                            extraCssText: "background-color: transparent; padding: 0 5px; border-color: transparent;",
                            formatter: function(params){
                                return `<div class="cx-tooltip">增速率: ${params[0].value}%</div>`
                            },
                            axisPointer: {
                                type: 'cross',
                                crossStyle: {
                                    axisPointer: {
                                        type: 'cross',
                                        crossStyle: {
                                            color: '#fff'
                                        },
                                        lineStyle: {
                                            type: 'dashed'
                                        }
                                    }
                                },
                                lineStyle: {
                                    type: 'dashed'
                                }
                            }
                        },
                        grid: {
                            top: '20%',
                            left: '5%',
                            right: '8%',
                            bottom: '15%',
                            containLabel: true
                        },
                        legend: {
                            top: "0%",
                            right: '2%',
                            textStyle: {
                                color: "#fff",
                                fontSize: 14
                            },
                            itemGap: 26,
                            itemWidth: 25,
                            itemHeight: 4,
                            icon: 'rectangle',
                            data: ['统计', '拆分']
                        },
                        xAxis: {
                            type: 'category',
                            data: yearData,
                            axisTick: {
                                show: false,
                            },
                            axisLine: {
                                lineStyle: {
                                    color: 'rgba(255, 255, 255, .05)'
                                }
                            },
                            axisLabel: {
                                margin: 10,
                                fontSize: '.1rem',
                                formatter: "{value}年",
                                color: '#fff'
                            }
                        },
                        yAxis: {
                            type: "value",
                            name: '%',
                            nameTextStyle: {
                                color: "#fff",
                                fontSize: "",
                                padding: [0, 0, 0, -20],
                            },
                            show: true,
                            axisTick: {
                                show: false,
                            },
                            axisLine: {
                                show: false,
                                lineStyle: {
                                    color: "rgba(255, 255, 255, .09)"
                                }
                            },
                            splitLine: {
                                show: true,
                                lineStyle: {
                                    color: "rgba(255, 255, 255, .09)"
                                }
                            },
                            axisLabel: {
                                fontSize: '.12rem',
                                color: '#fff'
                            }
                        },
                        dataZoom: [
                            {
                                type: 'slider',
                                startValue: 0,
                                endValue: 7,
                                bottom: '20',
                                left: '30',
                                height: 10,
                                borderColor: '#1479A1',
                                textStyle: {
                                    color: '#05D5FF',
                                },
                                backgroundColor: '#032E5C',
                                dataBackground: {
                                    lineStyle: { color: 'rgba(250, 84, 28, .3)' },
                                    areaStyle: { color: 'rgba(250, 84, 28, .5)' }
                                },
                                moveHandleStyle: {
                                    color: 'rgba(38, 203, 251, 1)',
                                    borderColor: 'rgba(38, 203, 251, 1)'
                                },
                                fillerColor: 'rgba(250, 84, 28, .1)'
                            }
                        ],
                        series: [
                            {
                                name: "统计",
                                type: "line",
                                data: tjData,
                                symbolSize: 5,
                                symbol: "circle",
                                smooth: true,
                                yAxisIndex: 0,
                                showSymbol: false,
                                lineStyle: {
                                    width: 3,
                                    color: '#D3B15F',
                                },
                                itemStyle: {
                                    color: "rgba(211, 177, 95, 1)",
                                    borderColor: "rgba(211, 177, 95, 0.8)",
                                    borderWidth: 5,
                                }
                            },
                            {
                                name: "拆分",
                                type: "line",
                                data: cfData,
                                symbolSize: 5,
                                symbol: "circle",
                                smooth: true,
                                showSymbol: false,
                                lineStyle: {
                                    width: 3,
                                    color: "#00DCFF",
                                },
                                itemStyle: {
                                    color: "rgba(0, 220, 255, 1)",
                                    borderColor: "rgba(0, 220, 255, 0.8)",
                                    borderWidth: 5,
                                }
                            }
                        ]
                    };
                    myChart.setOption(option)
                },

                /**
                 * 绘制用能结构图表
                 */
                drawYNJGChart() {
                    const myChart = echarts.init(document.getElementById('ynjg'));
                    const yearData = []
                    for (let i = 2005; i < new Date().getFullYear() + 1; i++) {
                        yearData.push(i)
                    }
                    const res = {
                        buildings: yearData.map(item => Math.ceil(Math.random() * 100)),
                        hot: yearData.map(item => Math.ceil(Math.random() * 100)),
                        jcss: yearData.map(item => Math.ceil(Math.random() * 100)),
                        czjj: yearData.map(item => Math.ceil(Math.random() * 100)),
                        legend: ["城镇居建", "农村居建", "公共建筑", "集中供热", "建筑业", "基础设施"],
                        public: yearData.map(item => Math.ceil(Math.random() * 100)),
                        village: yearData.map(item => Math.ceil(Math.random() * 100)),
                        dw: "万吨标准煤",
                        memo: "城乡建设领域用能情况"
                    }
                    const data = {
                        legendData: [],
                        memo: "",
                        dw: ""
                    }

                    const {
                        buildings: jzyyn,
                        hot: jzgn,
                        jcss,
                        public: ggjz,
                        village: ncjj,
                        legend,
                        renjun_neng,
                        renjun_co2,
                        czjj,
                        memo,
                        dw
                    } = res

                    data.legendData = legend
                    data.memo = memo
                    data.dw = dw

                    const mockData = []
                    yearData.forEach((year, index) => {
                        mockData.push({
                            year,
                            energyData: {
                                czjj: czjj && czjj.length ? czjj[index] : '',
                                ncjj: ncjj && ncjj.length ? ncjj[index] : '',
                                ggjz: ggjz && ggjz.length ? ggjz[index] :'',
                                jzgn: jzgn && jzgn.length ? jzgn[index] : '',
                                jzyyn: jzyyn && jzyyn.length ? jzyyn[index] : '',
                                jcss: jcss && jcss.length ? jcss[index] : ''
                            }
                        })
                    })

                    const areaData = [],
                        seriesData = [],
                        czjjData = [], ncjjData = [], ggjzData = [], jzgnData = [], jzyynData = [], jcssData = []

                    mockData.forEach(item => {
                        const { areaName, energyData } = item
                        areaData.push(areaName)
                        const { czjj, ncjj, ggjz, jzgn, jzyyn, jcss } = energyData
                        czjjData.push(czjj)
                        ncjjData.push(ncjj)
                        ggjzData.push(ggjz)
                        jzgnData.push(jzgn)
                        jzyynData.push(jzyyn)
                        jcssData.push(jcss)
                    })
                    const legendKeyMap = {
                        "城镇居建": czjjData,
                        "农村居建": ncjjData,
                        "公共建筑": ggjzData,
                        "集中供热": jzgnData,
                        "建筑业": jzyynData,
                        "基础设施": jcssData
                    }

                    const XJJJ_COLOR = '#32B7CA'
                    const XJGJ_COLOR = '#D3B15F'
                    const JYJJGZ_COLOR = '#8371F0'
                    const JYGJGZ_COLOR = '#CF4A6F'
                    const KZSNY_COLOR = '#2477D1'
                    const JCSS_COLOR = '#20dc47'

                    const colorList = [XJJJ_COLOR, XJGJ_COLOR, JYJJGZ_COLOR,
                        JYGJGZ_COLOR, KZSNY_COLOR, JCSS_COLOR]
                    data.legendData.forEach((name, index) => {
                        seriesData.push({
                            name,
                            type:'bar',
                            barWidth: 11,
                            stack: data.memo,
                            data: legendKeyMap[name],
                            itemStyle: {
                                color: data.type === 0 ? colorList[index] : colorList[data.type - 1],
                                areaStyle: {
                                    color: new echarts.graphic.LinearGradient(
                                        0,
                                        0,
                                        0,
                                        1,
                                        [
                                            {
                                                offset: 0,
                                                color: "#000",
                                            },
                                            {
                                                offset: 0.5,
                                                color: "rgba(0, 149, 216, 0)",
                                            },
                                        ],
                                        false
                                    ),
                                }
                            }
                        })
                    })

                    const option = {
                        backgroundColor: "transparent",
                        title:{
                            show: false
                        },
                        legend: {
                            top: "2%",
                            left: '2%',
                            textStyle: {
                                color: "#fff",
                                fontSize: 12
                            },
                            itemWidth: 6,
                            itemHeight: 6,
                            icon: "circle",
                            data: data.legendData
                        },
                        tooltip : {//过滤掉统计的series
                            trigger: 'axis',
                            axisPointer : {            // 坐标轴指示器，坐标轴触发有效
                                type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                            },
                            confine: true,
                            formatter: function (params) {
                                let relVal = params[0].name;
                                let prefix
                                for (let i = 0, l = params.length; i < l; i++) {
                                    prefix = `<span style="display:inline-block;margin-right:5px;border-radius:10px;width:9px;height:9px;background-color: ${params[i].color}"></span>`
                                    relVal += '<br/>' + prefix + `${params[i].seriesName}` + ' : ' + `${params[i].value || 0} %`;
                                }
                                return relVal;
                            },
                        },
                        grid: {
                            top: '30%',
                            left: '3%',
                            right: '4%',
                            bottom: '15%',
                            containLabel: true
                        },
                        xAxis : [
                            {
                                type : 'category',
                                data : yearData,
                                axisLabel: {
                                    margin: 10,
                                    fontSize: '.1rem',
                                    formatter: "{value}年",
                                    color: '#fff'
                                }
                            }
                        ],
                        yAxis : [
                            {
                                name: '%',
                                nameTextStyle: {
                                    color: "#fff",
                                    fontSize: ".12rem",
                                    padding: [0, 0, 0, -50],
                                },
                                type : 'value',
                                splitLine: {
                                    show: true,
                                    lineStyle: {
                                        color: "rgba(255, 255, 255, .85)"
                                    }
                                },
                                axisLabel: {
                                    margin: 10,
                                    fontSize: '.12rem',
                                    formatter: "{value}",
                                    color: '#fff'
                                }
                            }
                        ],
                        dataZoom: [
                            {
                                type: 'slider',
                                startValue: 0,
                                endValue: 7,
                                bottom: '20',
                                left: '30',
                                height: 10,
                                borderColor: '#1479A1',
                                textStyle: {
                                    color: '#05D5FF',
                                },
                                backgroundColor: '#032E5C',
                                dataBackground: {
                                    lineStyle: { color: 'rgba(250, 84, 28, .3)' },
                                    areaStyle: { color: 'rgba(250, 84, 28, .5)' }
                                },
                                moveHandleStyle: {
                                    color: 'rgba(38, 203, 251, 1)',
                                    borderColor: 'rgba(38, 203, 251, 1)'
                                },
                                fillerColor: 'rgba(250, 84, 28, .1)'
                            }
                        ],
                        series: seriesData
                    }
                    myChart.setOption(option)
                },

                /**
                 * 绘制电气化率图表
                 */
                drawDQHLChart() {
                    const nhzlData = {
                        gonggong: [],
                        juzhu: [],
                        year: []
                    }
                    for (let year = 2005; year < new Date().getFullYear() + 1; year++) {
                        nhzlData.gonggong.push((Math.random() * 100).toFixed(2))
                        nhzlData.juzhu.push((Math.random() * 100).toFixed(2))
                        nhzlData.year.push(year)
                    }
                    const myChart = echarts.init(document.getElementById('dqhl'));
                    const option = {
                        backgroundColor:  'transparent',
                        tooltip: {
                            trigger: 'axis',
                            confine: true,
                            axisPointer: {
                                type: 'cross',
                                crossStyle: {
                                    axisPointer: {
                                        type: 'cross',
                                        crossStyle: {
                                            color: '#fff'
                                        },
                                        lineStyle: {
                                            type: 'dashed'
                                        }
                                    }
                                },
                                lineStyle: {
                                    type: 'dashed'
                                }
                            }
                        },
                        grid: {
                            top: '30%',
                            left: '5%',
                            right: '5%',
                            bottom: '15%',
                            containLabel: true
                        },
                        legend: {
                            left: '5%',
                            padding: [20, 30, 0, 0],
                            itemGap: 34,
                            data: ['电力消耗总量亿kwh', '电气化率'],
                            textStyle: {
                                color: '#fff',
                                fontSize: '.12rem'
                            },
                            itemWidth: 10,
                            itemHeight: 4
                        },
                        xAxis: [
                            {
                                type: "category",
                                axisTick: {
                                    show: false,
                                },
                                axisLine: {
                                    lineStyle: {
                                        color: 'rgba(255, 255, 255, .05)'
                                    }
                                },
                                data: nhzlData.year,
                                axisLabel: {
                                    margin: 10,
                                    fontSize: '.1rem',
                                    formatter: "{value}年",
                                    color: '#fff'
                                }
                            },
                        ],
                        yAxis: [
                            {
                                type: "value",
                                name: '单位：亿kwh',
                                position: 'left',
                                nameTextStyle: {
                                    color: "#fff",
                                    fontSize: "",
                                    padding: [0, 0, 0, 0],
                                },
                                show: true,
                                axisTick: {
                                    show: false,
                                },
                                axisLine: {
                                    show: false,
                                },
                                splitLine: {
                                    show: true,
                                    lineStyle: {
                                        color: "rgba(255, 255, 255, .85)"
                                    }
                                },
                                axisLabel: {
                                    fontSize: '.12rem',
                                    color: '#fff'
                                }
                            },
                            {
                                type: "value",
                                name: "单位：%",
                                position: 'right',
                                nameTextStyle: {
                                    color: "#fff",
                                    fontSize: "",
                                    padding: [0, 30, 0, 0],
                                },
                                axisTick: {
                                    show: false,
                                },
                                axisLine: {
                                    show: false,
                                    lineStyle: {
                                        color: "#fff",
                                    },
                                },
                                axisLabel: {
                                    margin: 10,
                                    color: "#A5B0B2",
                                    fontSize: '.12rem',
                                    formatter: "{value}"
                                },
                                splitLine: {
                                    show: true,
                                    lineStyle: {
                                        color: "rgba(255, 255, 255, .85)"
                                    }
                                }
                            }
                        ],
                        dataZoom: [
                            {
                                type: 'slider',
                                startValue: 0,
                                endValue: 7,
                                bottom: '20',
                                left: '30',
                                height: 10,
                                borderColor: '#1479A1',
                                textStyle: {
                                    color: '#05D5FF',
                                },
                                backgroundColor: '#032E5C',
                                dataBackground: {
                                    lineStyle: { color: 'rgba(250, 84, 28, .3)' },
                                    areaStyle: { color: 'rgba(250, 84, 28, .5)' }
                                },
                                moveHandleStyle: {
                                    color: 'rgba(38, 203, 251, 1)',
                                    borderColor: 'rgba(38, 203, 251, 1)'
                                },
                                fillerColor: 'rgba(250, 84, 28, .1)'
                            }
                        ],
                        series: [
                            {
                                name: "电力消耗总量亿kwh",
                                type: "bar",
                                barWidth: 8,
                                itemStyle: {
                                    borderWidth: 2,
                                    color: '#FCA805',
                                    borderRadius: 3
                                },
                                data: nhzlData.gonggong,
                            },
                            {
                                name: "电气化率",
                                type: 'line',
                                smooth: true,
                                symbolSize: 5,
                                symbol: 'circle',
                                label: {
                                    show: false
                                },
                                itemStyle: {
                                    borderWidth: 2,
                                    color: '#812340',
                                    borderColor: '#fff'
                                },
                                data: nhzlData.juzhu,
                            }
                        ]
                    };
                    myChart.setOption(option)
                },

                /**
                 * 绘制用能强度图表
                 */
                drawYNQDChart() {
                    const nhzlData = {
                        gonggong: [],
                        juzhu: [],
                        year: []
                    }
                    for (let year = 2005; year < new Date().getFullYear() + 1; year++) {
                        nhzlData.gonggong.push((Math.random() * 100).toFixed(2))
                        nhzlData.juzhu.push((Math.random() * 100).toFixed(2))
                        nhzlData.year.push(year)
                    }
                    const myChart = echarts.init(document.getElementById('ynqd'));
                    const option = {
                        backgroundColor:  'transparent',
                        tooltip: {
                            trigger: 'axis',
                            confine: true,
                            extraCssText: "background-color: transparent; padding: 0 5px; border-color: transparent;",
                            formatter: function(params){
                                return `<div class="cx-tooltip">用能强度: ${params[0].value}kgce/㎡</div>`
                            },
                            axisPointer: {
                                type: 'cross',
                                crossStyle: {
                                    axisPointer: {
                                        type: 'cross',
                                        crossStyle: {
                                            color: '#fff'
                                        },
                                        lineStyle: {
                                            type: 'dashed'
                                        }
                                    }
                                },
                                lineStyle: {
                                    type: 'dashed'
                                }
                            }
                        },
                        grid: {
                            top: '30%',
                            left: '5%',
                            right: '5%',
                            bottom: '15%',
                            containLabel: true
                        },
                        xAxis: [
                            {
                                type: "category",
                                axisTick: {
                                    show: true
                                },
                                axisLine: {
                                    lineStyle: {
                                        color: 'rgba(255, 255, 255, .05)'
                                    }
                                },
                                data: nhzlData.year,
                                axisLabel: {
                                    margin: 10,
                                    fontSize: '.1rem',
                                    formatter: "{value}年",
                                    color: '#fff'
                                }
                            },
                        ],
                        yAxis: {
                            type: "value",
                            name: '单位：kgce/㎡',
                            position: 'left',
                            nameTextStyle: {
                                color: "#fff",
                                fontSize: "",
                                padding: [0, 0, 0, 0],
                            },
                            show: true,
                            axisTick: {
                                show: false,
                            },
                            axisLine: {
                                show: false,
                            },
                            splitLine: {
                                show: true,
                                lineStyle: {
                                    color: "rgba(255, 255, 255, .85)"
                                }
                            },
                            axisLabel: {
                                fontSize: '.12rem',
                                color: '#fff'
                            }
                        },
                        dataZoom: [
                            {
                                type: 'slider',
                                startValue: 0,
                                endValue: 7,
                                bottom: '20',
                                left: '30',
                                height: 10,
                                borderColor: '#1479A1',
                                textStyle: {
                                    color: '#05D5FF',
                                },
                                backgroundColor: '#032E5C',
                                dataBackground: {
                                    lineStyle: { color: 'rgba(250, 84, 28, .3)' },
                                    areaStyle: { color: 'rgba(250, 84, 28, .5)' }
                                },
                                moveHandleStyle: {
                                    color: 'rgba(38, 203, 251, 1)',
                                    borderColor: 'rgba(38, 203, 251, 1)'
                                },
                                fillerColor: 'rgba(250, 84, 28, .1)'
                            }
                        ],
                        series: {
                            name: "用能强度",
                            type: "bar",
                            barWidth: 8,
                            itemStyle: {
                                borderWidth: 1,
                                color: '#0B7062',
                                borderColor: '#15FED1'
                            },
                            data: nhzlData.gonggong,
                        }
                    };
                    myChart.setOption(option)
                },

                handleYNQDToggle(yndqActive) {
                    this.ynqdActive = yndqActive
                    this.drawYNQDChart()
                },

                getCurrentDateTime() {
                    if (this.dateTimer) {
                        clearInterval(this.dateTimer)
                    }
                    this.dateTimer = setInterval(() => {
                        this.dateTime = moment(new Date()).format('YYYY/MM/DD HH:mm:ss')
                    }, 1000)
                },

                /**
                 * 绘制地图
                 */
                drawMapChart() {
                    const myChart = echarts.getInstanceById('mapContainer') || echarts.init(document.getElementById('mapContainer'))
                    const currentYear = this.currentYear
                    const customerBatteryCityData = [
                        {name: '北京市', value: 309.1},
                        {name: '天津市', value: 208.4},
                        {name: '河北省', value: 780.6},
                        {name: '山西省', value: 406.3},
                        {name: '内蒙古自治区', value: 4353.6},
                        {name: '辽宁省', value: 504.4},
                        {name: '吉林省', value: 261.5},
                        {name: '黑龙江省', value: 759.8},
                        {name: '上海市', value: 315.9},
                        {name: '江苏省', value: 549.5},
                        {name: '浙江省', value: 543.5},
                        {name: '安徽省', value: 342.2},
                        {name: '福建省', value: 323.1},
                        {name: '江西省', value: 211.7},
                        {name: '山东省', value: 808.5},
                        {name: '河南省', value: 608.5},
                        {name: '湖北省', value: 340.9},
                        {name: '湖南省', value: 419.4},
                        {name: '广东省', value: 967.2},
                        {name: '广西壮族自治区', value: 2467.2},
                        {name: '海南省', value: 71.4},
                        {name: '重庆市', value: 210.5},
                        {name: '四川省', value: 526.6},
                        {name: '贵州省', value: 271.9},
                        {name: '云南省', value: 245.5},
                        {name: '西藏自治区', value: 0},
                        {name: '陕西省', value: 356.7},
                        {name: '甘肃省', value: 2172.7},
                        {name: '青海省', value: 809.3},
                        {name: '宁夏自治区', value: 1045.4},
                        {name: '新疆维吾尔自治区', value: 3561.5}
                    ]
                    const loadMap = (features, mapData, zoom, provinceName) => {
                        const geoCoordMap = {}
                        features.forEach(item => {
                            const {properties} = item
                            const {cp, name} = properties
                            geoCoordMap[name] = cp
                        })
                        const option = {
                            silent: false,
                            tooltip: {
                                trigger: "item",
                                show: true,
                                textStyle: {
                                    fontSize: 14,
                                    color: "#fff",
                                },
                                borderWidth: 3,
                                borderColor: 'rgba(10, 113, 174, 0.8)',
                                backgroundColor: "rgba(0, 0, 0, 0.8)",
                                extraCssText: "padding: 0;",
                                formatter: function (params) {
                                    if (params.data) {
                                        return `
                                        <div class="map-tooltip">
                                            <div class="map-tooltip-header" style="border-bottom: 1px solid #5CB2E3; height: 40px; display: flex;align-items: center; padding: 0 10px;">
                                                <div class="header-icon" style="width: 5px;height: 5px; border-radius: 50%; background: #1CD5FF; margin-right: 5px;"></div>
                                                <div class="header-text">${ params.data.name }</div>
                                            </div>
                                            <div class="map-tooltip-content" style="padding: 10px 10px 10px 18px;">
                                                <div class="content-item">年度: ${currentYear}年</div>
                                                <div class="content-item">能耗: <span style="color: #FBEE16;font-weight: 600;">${params.data.value.length > 1 ? params.data.value[params.data.value.length - 1] : params.data.value}</span> 吨标煤</div>
                                            </div>
                                        </div>
                                    `
                                    } else {
                                        return 'tooltip'
                                    }
                                }
                            },
                            geo: {
                                map: provinceName,
                                roam: false,
                                zoom,
                                itemStyle: {
                                    borderColor: '#84B2FD',
                                    color: 'transparent',
                                    borderWidth: 3,
                                },
                                emphasis: {
                                    //当鼠标放上去  地区区域是否显示名称
                                    label: {
                                        show: true,
                                        color: "#fff",
                                        backgroundColor: "rgba(0, 0, 0, .25)",
                                    },
                                    itemStyle: {
                                        color: '#fcf565'
                                    },
                                },
                                select: {
                                    label: {
                                        show: true,
                                        color: "#fff"
                                    }
                                },
                                label: {
                                    show: true,
                                    color: '#fff',
                                    position: 'top',
                                    fontSize: 12,
                                    padding: 10
                                }
                            },
                            visualMap: {
                                max: 5000,
                                calculable: true,
                                inRange: {
                                    color: ['#115C9E', '#16EB9C']
                                },
                                padding: [0, 0, 50, 50],
                                textStyle: {
                                    color: '#fff'
                                },
                                text: ['高', '低'],
                            },
                            series: [{
                                map: provinceName,
                                zoom: this.zoom,
                                geoIndex: 0,
                                coordinateSystem: 'geo',
                                selectedMode: 'single',
                                showLegendSymbol: true,
                                type: 'map',
                                roam: false,
                                label: {
                                    normal: {
                                        show: true,
                                        textStyle: {
                                            color: "#fff",
                                        }
                                    },
                                    emphasis: {
                                        show: false,
                                        textStyle: {
                                            color: "#fff",
                                        }
                                    },
                                },
                                data: mapData
                            }]
                        }
                        myChart.setOption(option)
                    }
                    $.get(`../assets/mapJson/全国.json`, function (data) {
                        // echarts.registerMap('china', data) 显示南海九段线
                        echarts.getMap("china").geoJson.features;
                        loadMap(data.features, data.features.map(item => {
                            return {
                                name: item.properties.name,
                                value: parseFloat((Math.random() * 1000).toFixed(2))
                            }
                        }), 1.2, 'china')
                    })

                    myChart.on('click',  params => {
                        this.mapActive = "province"
                        const { name: provinceName } = params;
                        $.get(`../assets/mapJson/${provinceName}.json`, function (data) {
                            echarts.registerMap(provinceName, data);
                            loadMap(data.features, data.features.map(item => {
                                return {
                                    name: item.properties.name,
                                    value: parseFloat((Math.random() * 1000).toFixed(2))
                                }
                            }), 0.9, provinceName)
                        })
                    })
                },

                handleMapChina() {
                    this.mapActive = 'china';
                    this.drawMapChart();
                },

                handleNavClick(item) {
                    window.location.href = item.location;
                },

                handleCompareAnalysisClick() {
                    window.location.href = `compare-analysis.html?type=${this.mapActive}`
                }
            },
            computed: {
                navLeft() {
                    return this.navList.slice(0, 4)
                },
                navRight() {
                    return this.navList.slice(4)
                }
            },
            watch: {
                mapActive: {
                    immediate: true,
                    handler(mapActive) {
                        if (mapActive === 'china') {
                            this.leftBtnClass = 'area-group-item area-group-item--active'
                            this.rightBtnClass = 'area-group-item left-active'
                        } else {
                            this.leftBtnClass = 'area-group-item right-active'
                            this.rightBtnClass = 'area-group-item area-group-item--active'
                        }
                    }
                }
            },
            mounted() {
                this.$nextTick(() => {
                    this.drawNHZLChart();
                    this.drawYNZBChart();
                    this.drawYNZSChart();
                    this.drawYNJGChart();
                    this.drawDQHLChart();
                    this.drawYNQDChart();
                    this.drawMapChart();
                })
                this.getCurrentDateTime();
            }
        })
    </script>
</body>
</html>
